
<h2 class="border">Overview</h2>
<p>When what one user sees does not match what another sees within Foundry Virtual Tabletop, such as token positions not being accurate, this usually results from users being desynchronized.</p>
<p>This article addresses the common causes for users being out of sync with the Foundry VTT host. Typically this happens when something interferes with a player's connection to the host. Signs of sync issues include:</p>
<ul>
    <li>Changes to Actors, Items, or Journal Entries are not visible to the player</li>
    <li>Token positions do not update for one or more players</li>
    <li>Users regularly receive notifications that they have been disconnected from the server</li>
    <li>Users complain about frequently needing to refresh</li>
</ul>

<h2 class="border">Before You Begin</h2>
<p>The causes of desync issues are almost entirely client-based, though some networking issues can result in this problem from the host side it is most commonly resolved by users understanding what causes the desync and opting into some best-practices to address the problem. In rare cases, overuse of Add-on Modules can be the cause of of desynchronization issues. Sometimes the cause of these issues is difficult to pin down, especially if it only affects your players. Asking a player to connect and help test can help speed up the troubleshooting process.</p>
<p>Pressing 'Ctrl' + 'F5' (CMD + F5 for macOS) is usually sufficient to temporarily resolve desynchronization issues, but if it is a persistent and recurring problem it can be resolved with a little troubleshooting. </p>

<h2 class="border">Common Causes</h2>
<p>There are a few potential causes of desync issues. Modern browsers use features which can sometimes cause delays in processing in the interest of conserving battery power or ram usage, network issues can sometimes stall passing of websocket data between users, users may be using VPNs to connect to your server which can interfere with websocket data transfer, and in rare cases overuse of Add-on Modules can result in data desyncronization. However, desynchronization most commonly results from your users switching to another tab during the game, resulting in the browser placing Foundry VTT in an 'idle' state.</p>

<h3>Browser Idling</h3>
<p>Chromium-based browsers such as Google Chrome and Microsoft Edge use a feature called "Tab Freezing" which will automatically suspend processing of any tab that is in the 'background' or not focused by a user, placing it in an idle state. This feature disrupts the connection between player and host, as the tab will not respond to socket-requests, and when the user returns they will only receive the last few updates, leading to visible desync. </p>
<p>To prevent this, users should keep their Foundry VTT tab active during the game, whether by keeping it as the only tab open in a separate window or by not switching to other tabs for long periods.</p>

<p>Some browser extensions can also cause desync errors. Try connecting to Foundry VTT using an Incognito window or using another supported browser without extensions to confirm a browser extension is responsible, and wherever possible try to reduce the number of browser extensions in use. We are unable to provide insight into which specific browser extension may be responsible for this issue.</p>

<h3>Network Issues</h3>
<p>Whether your players are on an unreliable or slow internet connection, using a VPN, or your server setup is not quite correctly configured, the root cause is the same: websocket packets are not being correctly handled, resulting in users not receiving updates as expected.</p>
<p>Automated port forwarding through UPnP or misconfigured network settings can also cause desync issues.</p>
<h4>Users connecting through a VPN</h4>
<p>If your players are using a VPN service to connect to your game, they may experience interruptions (however brief) in their connection, or their VPN may not allow data transfer through the WebSocket protocol. Ask your players to connect without use of a VPN to see if the matter improves.</p>

<h4>Faulty UPnP</h4>
<p>Foundry VTT attempts to make an automatic port forwarding rule in your browser using a framework called Universal Plug and Play (UPnP). Generally if this works then connections are fine. Sometimes however UPnP can cause connection issues. To fix this we suggest you set up port forwarding manually. See @Article[port-forwarding] for instructions on how to do this. Restarting your router by unplugging its power for 30 seconds may provide a temporary resolution if port forwarding is not feasible at the current time.</p>

<h4>Incorrectly Configured Reverse-Proxy</h4>
<p>In rare cases, configuration of a reverse-proxy server can be the cause of websocket issues. To be sure this isn't the cause, please check that your reverse-proxy is configured correctly:</p>
<ul>
    <li>@Article[caddy]</li>
    <li>@Article[nginx]</li>
    <li>@Article[apache]</li> 
</ul>

<h3>Module Overload</h3>
<p>While add-on modules are a popular feature of Foundry Virtual Tabletop, using too many at once can lead to delays and desynchronization, especially in cases where multiple modules are attempting to update data at the same time. If you are using multiple modules that affect the same data (usually token modules), these conflicts can exacerbate user disconnections and desyncs.</p>
<ol>
    <li>Disable all modules by launching your World in Safe Configuration. See @Article[launch-safe-configuration] for instructions.</li>
    <li>Run your game session for a period of at least 30 minutes, asking your players to report when they experience a desynchronization.</li>
    <li>If multiple desynchronizations occur, modules are probably not responsible for this issue.</li>
    <li>If desynchronizations stop occurring, see <a href="https://foundryvtt.com/article/performance-issues/#modules">Module Performance Issues</a>.</li>
</ol>

<h2 class="border">I Am Still Experiencing Desync Issues</h2>
<p>Further troubleshooting will require direct assistance. <a href="/contact-us/" target="_blank" rel="nofollow noopener">contact us</a> or join our <a href="https://discord.gg/foundryvtt" target="_blank" rel="nofollow noopener">Discord community</a> for live support.</p>