<h2 class="border">Foundry Virtual Tabletop - Version # Phase # Release Notes</h2>
<figure>
    <img src="{BANNER_IMG}" title="Foundry VTT - Version # Phase # Release Notes" alt="Release Notes for Foundry Virtual Tabletop Version #"/>
    <figcaption>Welcome to the Foundry Virtual Tabletop update notes for Version # Phase #.</figcaption>
</figure>

<p class="note warning"><strong>WARNING:</strong> {RELEVANT_WARNING_MESSAGES}</p>

<p>{SUMMARY_OF_MAJOR_FEATURES}</p>

<h2 class="border">Update Highlights</h2>

<p>This update brings a vast amount of bug fixes in a variety of areas of the core software as reported by our awesome community. </p>

<div>
<h2 class="border">New Features</h2>
    <h3>Architecture and Infrastructure</h3>
    <ul>
        <li>Log files now also indicate which build number of the software is running, not just the Version number. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6620" target="_blank">6620</a>)</li>
        <li>An upstream update to <code>pixi/graphics-smooth</code> has been included which fixes an issue with small transparent pixel artfacts in freehand Drawings. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6729" target="_blank">6729</a>)</li>
    </ul>

    <h3>The Game Canvas</h3>
    <ul>
        <li>The Fog texture should now be properly committed to the database during a reload. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6571" target="_blank">6571</a>)</li>
        <li>Walls now use a new outline based visual style which should make them a little more visually smooth. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6599" target="_blank">6599</a>)</li>
        <li>The torch preset animation for Ambient Light sources has had its amplitude increased and is now properly halted when its speed is set to 0. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6624" target="_blank">6624</a>)</li>
    </ul>
    <h3>Dice and Cards</h3>
    <ul>
    <li>FateDie now supports reroll, rerollRecursive, keep, and drop dice modifiers. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6747" target="_blank">6747</a>)</li>
    <li>The CSS for Dice roll results has been improved and now ensures that dropped results take precedence over other stylings like successes/failures. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6774" target="_blank">6774</a>)</li>
    </ul>
    <h3>Interface and Applications</h3>
    <ul>
        <li>The context menu for chat messages now includes an option to delete the chat message. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6591" target="_blank">6591</a>)</li>
        <li>The representation of macOS meta-left and meta-right keys has been improved on the Configure Controls menu. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6649" target="_blank">6649</a>)</li>
        <li>The representation of macOS arrow keys was failing to render due to the macOS system font not supporting the unicode characters for arrow keys.  This has been resolved by changing how these elements are displayed for macOS to a functional but less visually pleasing appearance. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6650" target="_blank">6650</a>)</li>
        <li>The <code>/stream</code> page once again has a unique title. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6737" target="_blank">6737</a>)</li>

        <li>The appearance of Document and Folder creation buttons in sidebar directories has been improved. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6681" target="_blank">6681</a>)</li>
    </ul>
</div>
<div>
<h2 class="border">API Improvements</h2>

    <h3>Architecture and Infrastructure</h3>
    <ul>
        <li><code>Hooks.onError</code> has been made more resilient to non-Errors being thrown in downstream code and should now handle DOMExceptions in a more communicative way. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6669" target="_blank">6669</a>) (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6578" target="_blank">6578</a>)</li>
    </ul>
    
    <h3>Documents and Data</h3>
    <ul>
        <li>An optional <code>Token#setPosition recenter</code> option has been added to bypass automatic canvas re-centering, this option defaults to <code>true</code> when used. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6719" target="_blank">6719</a>)</li>
        <li>Synthetic (unlinked) token actors should now properly retain data updated using the the property deletion prefix <code>-=</code>. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6421" target="_blank">6421</a>) </li>
        <li>The unused data keys <code>_canUpdate</code> and <code>_canDelete</code> within <code>BaseMacro#metadata.permissions </code> have been removed. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6694" target="_blank">6694</a>)</li>

    </ul>
    
    
    <h3>The Game Canvas</h3>
    <ul>
        <li><code>lineSegmentIntersects</code> has been improved and should now handle cases of collinear lines more effectively. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6765" target="_blank">6765</a>)</li>

    </ul>
    <h3>Interface and Applications</h3>
    <ul>
        <li>The extraction of <code>DragEvent</code> data has been refactored for improved standardization. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6772" target="_blank">6772</a>)</li>
        <li><code>.xml application/xml</code> is now supported as a filtype which can be uploaded within the FilePicker. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6621" target="_blank">6621</a>)</li>
        <li>When revealing an existing message in the chat log, it will now be added in-place instead of appended to the end of the chatlog. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6716" target="_blank">6716</a>)</li>
        
    </ul>
    <h3>Other Changes</h3>
    <ul>
        <li>The unused <code>VideoHelper#videos</code> has been removed. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/5893" target="_blank">5893</a>)</li>
    </ul>
</div>
<div>
    <h2 class="border">Documentation Improvements</h2>
    <ul>
        <li>The documentation for <code>ClockwiseSweepPolygon</code> has been improved and now references the augmented <code>PolygonRay</code> type which includes the ray result instead of the base Ray class. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6401" target="_blank">6401</a>)</li>
        <li><code>PointSourcePolygon</code> has had its documentation revised to correct some inaccuracies. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6462" target="_blank">6462</a>)</li>
        <li><p>Notifications#_renderInner</p> should now match <code>Application#_renderInner</code>. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6554" target="_blank">6554</a>)</li>
        <li>The documented <code>return</code> type has been corrected for <code>TextureLoader#loadVideoTexture</code>, <code>TextureLoader#loadImageTexture</code>, <code>Folder#createDialog</code> and <code>CompendiumCollection#importDialog</code>. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6589" target="_blank">6589</a>) (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6619" target="_blank">6619</a>) (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6660" target="_blank">6660</a>)</li>
        <li>A number of methods in <code>DocumentCollection</code> have had their documentation updated to indicate that they are <code>protected</code> instead of private. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6659" target="_blank">6659</a>)</li>
        <li>Some inaccuracies in the documentation for <code>Cards#pass</code> have been corrected. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6668" target="_blank">6668</a>)</li>
    </ul>
</div>


<div>
<h2 class="border">Localization Improvements</h2>
<ul>
    <li>The <code>title</code> attribute on the links in <code>manifest-update.html</code> should now correctly include version numbers for  package versions. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6682" target="_blank">6682</a>)</li>
    <li>Roll Table chat message flavor text now supports localization. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6686" target="_blank">6686</a>)</li>
    <li>Timestamp indicator text (such as h, min, hour, etc) now supports localization. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6752" target="_blank">6752</a>)</li>
</ul>
</div>
<div>
<h2 class="border">Bug Fixes</h2>
    <h3>Architecture and Infrastructure</h3>
    <ul>
        xx <li>Foundry does not load on Slow Internet Speed while using Microsoft Edge. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6481" target="_blank">6481</a>)</li>
        <li>Socket operations which throw an error on the server side should no longer be unnecessarily broadcast to connected clients. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6695" target="_blank">6695</a>)</li>
        <li>Deleting multiple folders which contain circular references can cause the server process to enter an infinite recursion. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6698" target="_blank">6698</a>)</li>
    </ul>

    <h3>Documents and Data</h3>
    <ul>
        <li>The FPS meter should no longer display inaccurate values for macOS users when a token is selected. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6423" target="_blank">6423</a>)</li>
        <li>Programmatically creating a scene and tokens should now properly display the created tokens without requiring a refresh. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6431" target="_blank">6431</a>)</li>
        <li>The <code>VideoHelper</code> pending queue should no longer cause video files to appear to stutter. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6435" target="_blank">6435</a>)</li>
        <li>Linked actor token bars should now properly update when changed by active effects. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6508" target="_blank">6508</a>)</li>
        <li>Players should no longer be able to control hidden tokens. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6610" target="_blank">6610</a>)</li>
        <li>To prevent cases where Dynamic Document Links would fail to properly resolve in cases where a compendium name contained <code>.</code>, compendiums no longer support using <code>.</code> in their names. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6629" target="_blank">6629</a>)</li>
        <li>Saving Default Token Resource Bar attributes should now function as expected. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6663" target="_blank">6663</a>) (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6661" target="_blank">6661</a>)</li>
        <li>A race condition within <code>Token.draw</code> which could cause issues when dragging non-looped video tokens has been resolved. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6676" target="_blank">6676</a>)</li>
        xx <li>ActiveEffect&#x27;s sourceName is Unknown on first call but correct on second. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6702" target="_blank">6702</a>)</li>
        <li>Activating a scene should no longer incorrectly result in the data for other scenes becoming unprepared. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6714" target="_blank">6714</a>)</li>
        <li>Players demoted from a GM role should no longer retain ability to navigate to scenes they created. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6749" target="_blank">6749</a>)</li>
        <li>Files with <code>.db</code> within in their filename but which are not explicitly <code>.db</code> files should no longer be incorrectly prevented from being accessed. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6612" target="_blank">6612</a>)</li>
        
    </ul>
    <h3>The Game Canvas</h3>
    <ul>
        <li>Terrain walls now properly render for cases where they share an endpoint with one or more non-terrain walls. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6416" target="_blank">6416</a>)</li>
        <li>Resolved a wall-chaining issue related to hotkey detection specific to Firefox for macOS. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6685" target="_blank">6685</a>)</li>
        <li><code>FogExploration</code> should no longer process updates as a result of an <code>ESC</code> keypress in cases where there is no data to commit. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6754" target="_blank">6754</a>)</li>
        <li><code>getPixelsFromGridPosition</code> and <code>getGridPositionFromPixels</code> should now provide consistent results when used on a hex-based grids. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6551" target="_blank">6551</a>)</li>
        <li>Non-GM users are now properly prevented from creatiung a measured template using an author ID that is not their own. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6565" target="_blank">6565</a>)</li>
        <li>Highlighting all objects using the <code>ALT</code> key is now distinguished from an actual hover which applies to a specific object. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6677" target="_blank">6677</a>)</li>
        <li>Polygon Drawings should now be correctly closed in cases where the origin point was a non-integer. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6740" target="_blank">6740</a>)</li>
        <li>Tokens attempting to move into a space partially bisected by a wall should no longer appear to snap back a partial grid space during the completion of a move. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6744" target="_blank">6744</a>)</li>
        xx <li>Token zIndexes should now properly persist between refreshes. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6751" target="_blank">6751</a>)</li>
        <li>Attempting to perform programmatic updates on canvas placeables such as Tokens and Tiles immediately after their creation should no longer fail with an error. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6434" target="_blank">6434</a>)</li>
        <li>To handle rare cases where a mouse move is simultaneous with a cancellation or completion event, safeguards have been implemented against the previewed Placeable object being prematurely destroyed in the <code>_onDragLeftMove</code> handler. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6741" target="_blank">6741</a>)</li>
        <li>Updates to Tile dimensions which would place them outside of bounds of the canvas as a result of negative values in height or width should now be handled properly. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6756" target="_blank">6756</a>)</li>
        <li>Updating position or rotation of a Roof Overhead Tile should now refresh token vision. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6763" target="_blank">6763</a>)</li>
        <li>Roof tiles should now properly handle light sources with a negative luminosity. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6764" target="_blank">6764</a>)</li>
        <li>Hidden Tiles with the radial occlusion mode set should now be rendered as partially transparent from the GM view. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6767" target="_blank">6767</a>)</li>
        <li><code>Tile#refresh</code> should no longer incorrectly reset the alpha of occluded tile. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6768" target="_blank">6768</a>)</li>
        <li>Resizing a tile with a negative height or width with its drag handle should no longer reset the tile to a positive value. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6769" target="_blank">6769</a>)</li>
        <li>Previews of changes to Tiles should now correctly reset when the configuration dialog is dismissed instead of being saved. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6757" target="_blank">6757</a>)</li>
        <li>Animated tiles should no longer re-synchronize as a result of being in an inactive tab for a period of time. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6558" target="_blank">6558</a>)</li>
        <li>Tiles that include audio should no longer result in doubling of the audio when a refresh of the Tile is triggered. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6511" target="_blank">6511</a>)</li>
        <li>Releasing the resize handle of a tile should no longer cause the tile to briefly flicker back to its original size before correctly rendering its resized form. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6692" target="_blank">6692</a>)</li>
        <li>A race condition which could occur in <code>_unlinkVideoPlayback</code> as a result of a missing await has been resolved. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6770" target="_blank">6770</a>)</li>
        <li>Resolved a permissions issue which would cause mouse cursor indicators to not be displayed unless &quot;Display Ruler Measurement&quot; was also enabled. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6691" target="_blank">6691</a>)</li>
        <li><code>screenDimensions</code> should now correctly update after a resize operation is performed. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6709" target="_blank">6709</a>)</li>

    </ul>
    <h3>Dice and Cards</h3>
    <ul>
        <li>An error thrown when a user <code>Combat#rollInitiative</code> is called for a combatant that the user doesn't own has been resolved. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6561" target="_blank">6561</a>)</li>
        <li><code>_processDiceCommand</code> should now correctly preserve <code>chatData</code>. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6566" target="_blank">6566</a>)</li>
    </ul>
    <h3>Interface and Applications</h3>
    <ul>
        <li>Changing initiative via the Combat Configuration dialog should now preserve the state of the active combatant. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6492" target="_blank">6492</a>)</li>
        <li>A number of cases where the combat tracker might inconsistently handle initiative values that have been set to 0 have been resolved. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6490" target="_blank">6490</a>)</li>
        <li><code>Combat.rollInitiative</code> should now be correctly governed by the current rollMode. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6667" target="_blank">6667</a>)</li>
        

        <li>Activating scenes which were configured to trigger the same playlist song with a fade duration should no longer result in the song ending prematurely when one scene reaches its fadeout duration. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6617" target="_blank">6617</a>)</li>
        <li><code>KeyboardManager#keyDown</code> should now update properly if a key is released while an input field has focus. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6652" target="_blank">6652</a>)</li>
        <li><code>keyboard#downKeys</code> should now have a recorded state regardless of whether an input element has focus. This avoids a bug where keypresses that occur during a momentary focus can become lost or stuck. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6683" target="_blank">6683</a>)</li>
        <li>Double-clicking the input field when setting a keybinding should no longer cause the input field to disappear. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6750" target="_blank">6750</a>)</li>

        

        <li>Permissions for Macros should now be more consistent with regard to execution prevention. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6748" target="_blank">6748</a>)</li>

        <li>In some cases a string handling method from the <code>numberInput</code> helper would result in logged console warnings. This should no longer be the case. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6572" target="_blank">6572</a>)</li>
        
        <li>A recurrant issue where plain text data dropped into a TinyMCE editor would fail has been resolved. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6766" target="_blank">6766</a>)</liA>

        <li>The ChatLog textarea now uses a native JavaScript DragEvent handler instead of incorrectly using the jQuery "drop" handler. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6773" target="_blank">6773</a>)</li>
        <li>Chat messages containing very long single words should now break and hyphenate onto multiple lines. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6678" target="_blank">6678</a>)</li>
        <li>The <code>Number.fromString</code> helper method should now correctly handle being passed a number instead of a string. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6634" target="_blank">6634</a>)</li>
        <li>Using Ctrl+Del in TinyMCE should no longer insert extraneous <code>&lt;span&gt;</code> elements. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6746" target="_blank">6746</a>)</li>

      
        <li>Tiles with audio should no longer continue to play after navigating to different scene. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6602" target="_blank">6602</a>)</li>
        <li>Sounds played from Journal Entries should now have their volume governed by the global volume controls. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6745" target="_blank">6745</a>)</li>
        <li>The Scene Controls CSS has been revised to prevent the box-shadow from being unnecessarily truncated. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6724" target="_blank">6724</a>)</li>
        <li>Changing font size from 5 to 6 should no longer have an undesirable effect on the gap between results on Rollable Tables. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6623" target="_blank">6623</a>)</li>
        <li>Some inconsistencies in the software update workflow have been addressed to make it clear whether the software is downloading or extracting the update package. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6684" target="_blank">6684</a>)</li>
        <li>Fonts which fail to load during initialization should no longer be presented as options in selection dropdowns. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6607" target="_blank">6607</a>)</li>
    </ul>
</div>
