<h2 class="border">Foundry Virtual Tabletop - Version 9 Testing 3 Release Notes</h2>
<figure>
    <img src="{BANNER_IMG}" title="Foundry VTT - Version 9 Testing 3 Release Notes" alt="Release Notes for Foundry Virtual Tabletop Version #"/>
    <figcaption>Welcome to the Foundry Virtual Tabletop update notes for Version 9 Testing 3.</figcaption>
</figure>

<p>{PREAMBLE}</p>

<p class="note warning"><strong>WARNING:</strong> {RELEVANT_WARNING_MESSAGES}</p>

<p>{SUMMARY_OF_MAJOR_FEATURES}</p>

<h2 class="border">Update Highlights</h2>

<p>As this is the final update in the Feature Testing phase, we spent the majority of effort during this period working to ensure stability and correct more bugs submitted by our users! There aren't a lot of features to highlight during this update, but please look forward to a more detailed summary of all the awesome changes in Version 9 in our stable release notes coming soon!</p>
<h4>Keybindings UI</h4>
<p>This update brings with it the ability to specifically rebind and customize hotkeys using our new Keybindings UI. This workflow allows users to choose keys at the press of a button, remapping specific functions to specific keys on their keyboard. It also relaxes some of the restrictions we had placed on keys reserved by core functions to allow remapping those. Gamepad buttons can also be used to map those functions, for those gamepad enthusiasts out there. At this time, you cannot overwrite mouse button presses in order to prevent situations where users might unbind some very important core functionality from mouse clicks. Keybindings are based on individual setting, per world and per user, and will need to be configured each time you join a new world.</p>
<h4>A Few Last-Minute Features</h4>
<p>We couldn't have an update go out completely without feature changes, so we managed to smuggle a few last minute tweaks in. This update brings appearance and performance improvements to light sources with gradual illumination and our new approach to wall-vertex detection. It also brings some changes for Cards, allowing them to be "played" from a Hand with an associated chat message, and also offers new options when creating a deck to pre-populate it with cards from a standard poker deck in either a light or dark theme.   </p>

<h4>As Many Bugs as We Can Fix</h4>
<p>As we focus our efforts on bringing V9 to the masses, the bugs that are being found are mostly minor ones. We resolved an issue with the client-side caching of files which resulted in users needing to force refreshes for the software during the testing phase, have corrected numerous minor edge-case issues with lighting and vision, and improved upon a number of shader-related issues with light sources. Mac users will also be pleased to know that the issue with the electron application in Monterey (12.1) which caused the application to refresh when clicked in the dock has been resolved. </p>
<div>
<div>
<h2 class="border">New Features</h2>
    <h3>Architecture and Infrastructure</h3>
    <ul>
        <li>A more informative error message is now logged if the application fails to start due to its port already being used by another application. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6282" target="_blank">6282</a>)</li>
    </ul>
    <h3>The Game Canvas</h3>
    <ul>
        <li>The easing for light sources with gradual illumination has been improved when lumonosity is set to a value greater than 0.5. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6266" target="_blank">6266</a>)</li>
        <li>Wall intersection vertices are now tested for whether they are inside a limited angle for field of vision, further improving performance and accuracy of vision calculations. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6255" target="_blank">6255</a>)</li>
        <li>In cases where the software detects the unmasked GPU renderer to as a CPU-emulated software renderer (such as Swiftshader), a warning that hardware acceleration may be disabled is now displayed. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6291" target="_blank">6291</a>)</li>
    </ul>
    <h3>Dice and Cards</h3>
    <ul>
        <li>Card Stack creation now offers a "Preset Configuration" selection menu which allows for pre-populating a Card Stack with a pre-existing template of playing cards. Templates for a dark themed and light themed poker deck are included by default.(<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6286" target="_blank">6286</a>)</li>
        <li>Cards may now be "played" from a Hand, and will post a chat message indicating the card has been played and by which user played it. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6290" target="_blank">6290</a>)</li>
    </ul>
        
    <h3>Interface and Applications</h3>
    <ul>
        <li>It is now possible to reassign many keys using the new Keybindings UI, allowing for customization of keyboard controls. Please note: mouse button clicks may not be remapped. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6094" target="_blank">6094</a>)</li>
        <li>More of the core keybindings may not be remapped to custom keys, including controls for targeting, opening a character sheet, deleting objects, pausing, and much more. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6275" target="_blank">6275</a>)</li>
        <li>The MacOS electron application now provides a custom context menu which ccan be used to open the User Data folder or Application folder, bringing feature parity with the Windows 10 application context menu. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6280" target="_blank">6280</a>)</li>
        <li>Pluralization and hyperlinking support for packages have been added to the package installer application, bringing feature partiy with the setup view of packages. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6285" target="_blank">6285</a>)</li>
        <li>Darkness Activation Range has been moved to the Basic tab on lighting configuration menu. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6257" target="_blank">6257</a>)</li>
    </ul>
    <h3>Other Changes</h3>
    <ul>
        <li>When a world is launched for the first time, some helpful getting started messages are now automatically created in the chat log, directing users to next steps and beginner documentation. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6184" target="_blank">6184</a>)</li>
    </ul>
</div>
<div>
    <h2 class="border">API Improvements</h2>
    <h3>Documents and Data</h3>
    <ul>
        <li>To allow more fine-grained control over when IDs for embedded objects are preserved or regenerated during import actions, a new <code>keepEmbeddedIds DocumentModificationContext</code> option has been added. This option defaults to true. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6267" target="_blank">6267</a>)</li>
    </ul>
    <h3>The Game Canvas</h3>
    <ul>
    <li>Lighting shaders now use more canonical naming conventions for variable names and theory for gamma and luminance. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6054" target="_blank">6054</a>)</li>
    </ul>
</div>
<div>
    <h2 class="border">Documentation Improvements</h2>
    <ul>
        xx <li>Document#canUserCreate is broken for document types that use a _canCreate method for the create permision. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6271" target="_blank">6271</a>)</li>
        <li>Corrected the documented <code>Return</code> type for <code>fetchJsonWithTimeout</code>. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6270" target="_blank">6270</a>)</li>
        <li>Corrected the documented parameter type for <code>ClientKeybindings._onZoom</code> documents wrong parameter type. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6273" target="_blank">6273</a>)</li>
        <li>Corrected JSDoc string for <code>HandlebarsHelpers.rangePicker</code> to indicate range rather than color. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6284" target="_blank">6284</a>)</li>
    </ul>
</div>

<div>
<h2 class="border">Localization Improvements</h2>
<ul>
    <li>Files named using non-roman letter characters should now be correctly located by the filebrowser filter. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6261" target="_blank">6261</a>)</li>
    <li>Added localization for a number of missing localization strings on the Token, Prototype Token, and Combatant Status configuration sheets. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6295" target="_blank">6295</a>)</li>
</ul>
</div>
<div>
<h2 class="border">Bug Fixes</h2>
    <h3>Architecture and Infrastructure</h3>
    <ul>
        <li>An issue which would result in users being logged out when clicking the FVTT application icon in the dock for MacOS Monterey has been resolved. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6246" target="_blank">6246</a>)</li>
        <li>Updating from the setup menu should no longer result in cases where the version number updates even if the update process fails. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6260" target="_blank">6260</a>)</li>
    </ul>
    <h3>Dice and Cards</h3>
    <ul>
        <li>Deleting a Card document from a compendium no longer throws an error. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6293" target="_blank">6293</a>)</li>
    </ul>
    <h3>The Game Canvas</h3>
    <ul>
       xx <li>SynchronizedTransform is missing local transform update of the reference. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/5966" target="_blank">5966</a>)</li>
        <li>Decreasing light source luminosity below zero no longer incorrectly removes the applied coloration. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/5908" target="_blank">5908</a>)</li>
        <li>Desaturated light sources with negative luminosity should now have an appearance more in line with expectation. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6059" target="_blank">6059</a>)</li>
        <li>In some cases vision was not correctly rendered when a token was selected for the first time, this issue should now be resolved. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6219" target="_blank">6219</a>)</li>
        <li>Drag operations which occur while placing walls should no longer result in a thrown error. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6248" target="_blank">6248</a>)</li>
        <li>Grid highlights through rulers and measured templates should no longer disappear when a scene configuration window is closed. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6250" target="_blank">6250</a>)</li>
        <li>To correct for an issue which could make it seem as if an unused space was present at the outer edge of light sources, light source illumination falloff now uses the <code>AdaptiveIlluminationShader</code> for smoother blending with the background color at the outer edges of light sources. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6258" target="_blank">6258</a>)</li>
        <li>Perception updates which are submitted while another perception update is already in progress are now correctly handled on next update instead of incorrectly discarded. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6277" target="_blank">6277</a>)</li>
        <li>Hidden tokens are no longer incorrectly displayed for GM users when outside of an active vision polygon. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6279" target="_blank">6279</a>)</li>
        <li>Vision calculation for limited angles greater than 180 should once again render correctly. This behaviour was resolved by passing an angle (in degrees) into the method explicitly rather than relying upon a difference in radians. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6289" target="_blank">6289</a>)</li>
    </ul>
    <h3>Interface and Applications</h3>
    <ul>
        <li>To resolve numerous issues which occurred as a result of browser cache handling, the FVTT client side now uses <code>Cache-Control: no-cache</code> to always validate with the server if a file is still valid to be served from cache. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6256" target="_blank">6256</a>)</li>
        <li>Error messages on the update tab no longer result in UI elements being pushed outside of menu frame. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6262" target="_blank">6262</a>)</li>
        <li>Switching tabs in the Module Management configuration application should now remember changes made when changing tabs within the window. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6268" target="_blank">6268</a>)</li>
        <li>The Reset to Default function in the Module Settings menu should once again reset sliders as expected. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6269" target="_blank">6269</a>)</li>
        <li>Clicking Save Changes in the Configure Settings menu should now only result in a scene reloading when changes have been made that require it. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6278" target="_blank">6278</a>)</li>
        <li>The Playlist tab should once again render correctly when popped out. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6298" target="_blank">6298</a>)</li>
    </ul>
    <h3>Other Changes</h3>
    <ul>
        <li>To correct for some cases where closing a dialog window without making a choice would throw an error, usage of <code>Dialog.prompt</code> should now correctly use the <code>rejectClose: false</code> option. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6247" target="_blank">6247</a>)</li>
        <li>Returning to setup from an active world no longer throws an error. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6249" target="_blank">6249</a>)</li>
        <li><code>_onCreateEmbeddedDocuments</code> and <code>_onDeleteEmbeddedDocuments</code> no longer ignore the render context option. (<a href="https://gitlab.com/foundrynet/foundryvtt/-/issues/6294" target="_blank">6294</a>)</li>
    </ul>
</div>
